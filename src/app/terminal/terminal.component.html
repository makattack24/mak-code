<div class="terminal-container" [ngClass]="pinPosition" [class.minimized]="isMinimized" [style.height.px]="height">
    <div #resizeHandle class="terminal-resize-handle"></div>
    <div class="terminal-toolbar">
        <app-themetoggle></app-themetoggle>
        <!-- Login/Logout buttons -->
        <ng-container *ngIf="auth.isAuthenticated$ | async as isAuth; else showLogin">
            <span class="user-email">{{ (auth.user$ | async)?.email }}</span>
            <button class="toolbar-btn" (click)="auth.logout({ logoutParams: { returnTo: locationOrigin } })"
                title="Logout">
                Logout
            </button>
        </ng-container>
        <ng-template #showLogin>
            <button class="toolbar-btn" (click)="auth.loginWithRedirect()" title="Login">
                Login
            </button>
        </ng-template>
        <button *ngIf="!isMinimized" class="toolbar-btn" title="Minimize" (click)="minimizeTerminal()">
            <svg width="16" height="16" viewBox="0 0 16 16">
                <polyline points="4,6 8,10 12,6" fill="none" stroke="#00e676" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
        <button *ngIf="isMinimized" class="toolbar-btn" title="Restore" (click)="restoreTerminal()">
            <svg width="16" height="16" viewBox="0 0 16 16">
                <polyline points="4,10 8,6 12,10" fill="none" stroke="#00e676" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </button>
    </div>
    <div class="terminal" *ngIf="!isMinimized" (click)="focusInput()">
        <div class="terminal-lines" #linesContainer>
            <div *ngFor="let line of lines">
                <span *ngIf="line.type === 'command'" class="terminal-command">{{ line.text }}</span>
                <span *ngIf="line.type === 'output'" class="terminal-output" [innerHTML]="line.text"></span>
            </div>
        </div>
        <div class="terminal-input">
            <span>&gt;</span>
            <input #terminalInput [(ngModel)]="input" (keydown)="handleInput($event)" autocomplete="off"
                spellcheck="false" (focus)="isInputFocused = true" (blur)="isInputFocused = false"
                (click)="$event.stopPropagation()" />
        </div>
    </div>
</div>